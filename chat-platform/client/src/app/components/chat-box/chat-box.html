<div class="flex chat-box py-2 border-[20px] border-transparent flex-col">
    <div class="h-100">
        @if(chatService.chatMessages().length > 5 && chatService.hasMoreMessages()) {
            <div class="text-center py-1 sticky top-0 w-full">
                <button (click)="loadMoreMessages()" class="text-gray-500 text-xs shadow px-5 py-5 rounded-full bg-gray-200 hover:text-gray-700 focus:outline-none">
                    @if (chatService.isLoading()) {
                         <div class="flex items-center gap-2">
                             <mat-spinner diameter="20" strokeWidth="3"></mat-spinner>
                             Carregando mensagens...
                        </div>
                    } @else {
                         Carregar Mais
                    }
                </button>
            </div>
        }

        @for(item of chatService.chatMessages(); track item.id){
            @if(item.senderId !== authService.currenLoggedtUser?.id){
                <div class="flex mb-3 flex-row items-center justify-normal">
                    <div class="flex items-center justify-center h-10 w-10 rounded-full bg-gradient-to-b from-green-400 to-blue-500 flex-shrink-0">
                        <img [src]="chatService.currentOpenedChat()?.profileImage"  [alt]="chatService.currentOpenedChat()?.fullName" class="h-8 w-8 rounded-full"/>
                    </div>
                    <div class="chat-message bg-white p-4 rounded-lg ml-2 shadow-sm">
                        <span class="text-sm text-gray-800 block">
                            {{item.content}}
                        </span>
                        <span class="text-right text-gray-400 text-[10px] block mt-1">
                            {{item.createDate | date: 'short'}}
                        </span>
                    </div>
                </div>
            }@else {
                <div class="flex flex-row items-center justify-end mb-3">
                    <div class="chat-message bg-blue-600 p-4 rounded-lg mr-2 shadow-sm text-white">
                        <span class="text-sm block">
                            {{item.content}}
                        </span>
                        <span class="text-right text-gray-200 text-xs block mt-1">
                            {{item.createDate | date: 'short'}}
                        </span>
                    </div>
                    <div class="flex items-center justify-center h-10 w-10 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex-shrink-0">
                        <img [src]="authService.currenLoggedtUser?.profileImage"  [alt]="authService.currenLoggedtUser?.fullName" class="h-8 w-8 rounded-full"/>
                    </div>
                </div>
            }
            }@empty {
                <div class="flex flex-col items-center justify-center h-full">
                    @if(chatService.isLoading()){
                        <mat-spinner diameter="40" strokeWidth="3"></mat-spinner>
                    } @else {
                        <mat-icon class="text-gray-400 chat-icon">chat</mat-icon>   
                    }
                    <h6 class="text-center text-gray-500">
                        Ainda não há mensagens aqui. Comece a conversar!
                    </h6>
                </div>
            }      
    </div>
</div>